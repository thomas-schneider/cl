tosca_definitions_version: cloudify_dsl_1_2

imports:
  - http://www.getcloudify.org/spec/cloudify/3.3.1/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.1/plugin.yaml

inputs:
  image:
    type: string
  flavor:
    type: string

plugins:
  my_test_plugin:
    executor: central_deployment_agent
    source: https://github.com/thomas-schneider/cl/archive/master.zip


node_templates:

  simpleapp:
    type: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        configure: scripts/install-simpleapp.sh
    relationships:
      - type: cloudify.relationships.contained_in
        target: nodejs


  vm_web:
    type: cloudify.openstack.nodes.Server
    properties:
      server:
        image: { get_input: image }
        flavor: { get_input: flavor }
      agent_config:
        user: 'centos'
        password: '123123'
    relationships:
      - target: web_floating_ip
        type: cloudify.openstack.server_connected_to_floating_ip

  web_floating_ip:
    type: cloudify.openstack.nodes.FloatingIP

  nodejs:
    type: cloudify.nodes.ApplicationServer
    relationships:
      - type: cloudify.relationships.contained_in
        target: vm_web
    interfaces:
      my_test_interface:
        print_hosts:
          implementation: my_test_plugin.plugin.tasks.print_hosts